<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>AIéŸ³å£°å…¥åŠ›ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆUI (éŸ³å£°èªè­˜ï¼‹èª­ã¿ä¸Šã’)</title>
<style>
    body {
        margin: 0;
        background: #0f0f0f;
        font-family: 'Segoe UI', sans-serif;
        overflow: hidden;
    }

    #waveCanvas {
        position: fixed;
        top: 0; left: 0;
        width: 100vw;
        height: 100vh;
        z-index: 0;
    }

    #ui {
        position: absolute;
        bottom: 5%;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1.5rem;
        z-index: 10;
    }

    #status-area {
        padding: 15px 30px;
        background: rgba(0, 0, 0, 0.5);
        border-radius: 12px;
        backdrop-filter: blur(5px);
        box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        color: #00ffff;
        font-size: 1.5rem;
        font-weight: bold;
        min-height: 40px; 
        display: flex;
        align-items: center;
        justify-content: center;
    }

    #input-controls {
        display: flex;
        gap: 1rem;
    }

    #messageInput {
        width: 400px;
        padding: 1rem;
        font-size: 1.2rem;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(0, 255, 255, 0.5);
        color: #fff;
        border-radius: 8px;
        backdrop-filter: blur(10px);
        outline: none;
    }

    #messageInput::placeholder {
        color: rgba(255, 255, 255, 0.4);
    }

    button {
        padding: 1rem 2rem;
        font-size: 1.2rem;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        backdrop-filter: blur(10px);
        transition: background 0.3s;
    }

    #sendBtn {
        color: #0f0f0f;
        background: #00ffff;
        box-shadow: 0 0 10px #00ffff;
    }
    #sendBtn:hover { background: #33ffff; }

    #micBtn {
        color: #0f0f0f;
        background: #00ffaa;
        box-shadow: 0 0 10px #00ffaa;
    }
    #micBtn.active {
        background: #ff5555;
        box-shadow: 0 0 20px #ff5555;
        color: #fff;
    }
</style>
</head>
<body>
    <canvas id="waveCanvas"></canvas>
    
    <div id="ui">
        <div id="status-area">AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆå¾…æ©Ÿä¸­...</div>

        <div id="input-controls">
            <input type="text" id="messageInput" placeholder="ã“ã“ã«æ–‡ç« ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
            <button id="micBtn">ğŸ¤ éŸ³å£°å…¥åŠ›</button>
            <button id="sendBtn">ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
    </div>

    <script>
        // === 1. æ³¢å½¢ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ ===
        const canvas = document.getElementById("waveCanvas");
        const ctx = canvas.getContext("2d");
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let bars = [];
        const barCount = 40;
        const barWidth = 8;
        const waveY = canvas.height / 2;
        let isSpeaking = false;
        function createBars() {
            bars = [];
            const startX = canvas.width / 2 - (barCount * barWidth) / 2;
            for (let i = 0; i < barCount; i++) {
                bars.push({ x: startX + i * barWidth, height: 10, color: "#00ffff" });
            }
        }
        function drawBars() {
            bars.forEach(bar => {
                ctx.fillStyle = bar.color;
                ctx.fillRect(bar.x, waveY - bar.height / 2, barWidth - 2, bar.height);
            });
        }
        function animateBars() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            bars.forEach(bar => {
                let targetHeight = isSpeaking ? Math.random() * 80 + 20 : 10 + Math.random() * 10;
                bar.height += (targetHeight - bar.height) * 0.15;
            });
            drawBars();
            requestAnimationFrame(animateBars);
        }

        // === 2. éŸ³å£°èª­ã¿ä¸Šã’ ===
        const messageInput = document.getElementById("messageInput");
        const statusArea = document.getElementById("status-area");
        const sendBtn = document.getElementById("sendBtn");
        const micBtn = document.getElementById("micBtn");

        const synth = window.speechSynthesis;
        let utterance = null;
        let currentTextToSpeak = "";

        function updateStatus(msg, color = '#00ffff') {
            statusArea.textContent = msg;
            statusArea.style.color = color;
            statusArea.style.boxShadow = `0 0 20px ${color}80`;
        }

        function speakSentence(text) {
            if (text.trim() === '' || text === currentTextToSpeak) return;

            if (synth.speaking) synth.cancel();
            currentTextToSpeak = text;

            utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'ja-JP';
            utterance.rate = 1.0;
            utterance.onstart = () => {
                isSpeaking = true;
                const shortText = text.length > 20 ? text.substring(0, 20) + '...' : text;
                updateStatus(`èª­ã¿ä¸Šã’ä¸­: ã€Œ${shortText}ã€`, '#00ffaa');
            };
            utterance.onend = () => {
                isSpeaking = false;
                updateStatus('AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆå¾…æ©Ÿä¸­...');
            };
            utterance.onerror = () => {
                isSpeaking = false;
                updateStatus('èª­ã¿ä¸Šã’ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', '#ff0000');
            };
            synth.speak(utterance);
        }

        // === 3. éŸ³å£°èªè­˜ ===
        let recognition;
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.lang = 'ja-JP';
            recognition.continuous = true;
            recognition.interimResults = true;

            recognition.onstart = () => {
                updateStatus("ğŸ¤ éŸ³å£°å…¥åŠ›ä¸­... è©±ã—ã¦ãã ã•ã„", '#00ffaa');
                micBtn.classList.add('active');
            };

            recognition.onresult = (event) => {
                let interim = "";
                let finalText = "";
                for (let i = 0; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalText += transcript;
                    } else {
                        interim += transcript;
                    }
                }
                messageInput.value = finalText || interim;
                if (finalText) speakSentence(finalText);
            };

            recognition.onend = () => {
                micBtn.classList.remove('active');
                updateStatus("AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆå¾…æ©Ÿä¸­...");
            };

            recognition.onerror = (event) => {
                micBtn.classList.remove('active');
                updateStatus("éŸ³å£°èªè­˜ã‚¨ãƒ©ãƒ¼: " + event.error, '#ff5555');
            };
        } else {
            updateStatus("ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°èªè­˜ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“", '#ff5555');
        }

        // === 4. ãƒœã‚¿ãƒ³æ“ä½œ ===
        micBtn.addEventListener('click', () => {
            if (!recognition) return;
            if (micBtn.classList.contains('active')) {
                recognition.stop();
            } else {
                recognition.start();
            }
        });

        sendBtn.addEventListener("click", () => {
            messageInput.value = "";
            if (synth.speaking) synth.cancel();
            if (recognition) recognition.stop();
            isSpeaking = false;
            currentTextToSpeak = '';
            updateStatus('ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚å…¥åŠ›ã‚’ãŠå¾…ã¡ã—ã¦ã„ã¾ã™...');
            messageInput.focus();
        });

        // === 5. å…¥åŠ›æ¬„ã‹ã‚‰ç›´æ¥èª­ã¿ä¸Šã’ ===
        messageInput.addEventListener('input', () => {
            const text = messageInput.value;
            if (text.trim() !== "") speakSentence(text);
            else {
                if (synth.speaking) synth.cancel();
                isSpeaking = false;
                updateStatus('AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆå¾…æ©Ÿä¸­...');
            }
        });

        // === 6. åˆæœŸåŒ– ===
        createBars();
        animateBars();
        messageInput.focus();
        updateStatus('AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆå¾…æ©Ÿä¸­...');
    </script>
</body>
</html>
