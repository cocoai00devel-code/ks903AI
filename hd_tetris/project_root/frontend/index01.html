<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>AIéŸ³å£°å…¥åŠ›ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆUI (PDFæ“¬ä¼¼å­¦ç¿’ç‰ˆ)</title>
    <style>
        body {
            margin: 0;
            background: #0f0f0f;
            font-family: 'Segoe UI', sans-serif;
            overflow: hidden;
        }

        /* 1. æ³¢å½¢ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®èƒŒæ™¯ */
        #waveCanvas {
            position: fixed;
            top: 0; left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 0;
        }

        /* 2. UIã‚³ãƒ³ãƒ†ãƒŠã®èª¿æ•´ (ä¸‹éƒ¨ã«å›ºå®š) */
        #ui {
            position: absolute;
            bottom: 5%;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
            z-index: 10;
        }

        /* 3. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¨ãƒªã‚¢ã®å®šç¾© */
        #status-area {
            padding: 15px 30px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 12px;
            backdrop-filter: blur(5px);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
            color: #00ffff;
            font-size: 1.5rem;
            font-weight: bold;
            min-height: 40px; 
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            max-width: 80vw;
        }
        
        /* 4. å…¥åŠ›ã¨ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #input-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        #messageInput {
            width: 400px;
            padding: 1rem;
            font-size: 1.2rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 255, 255, 0.5);
            color: #fff;
            border-radius: 8px;
            backdrop-filter: blur(10px);
            outline: none;
        }
        #messageInput::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }
        
        /* ãƒœã‚¿ãƒ³å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
        .control-btn {
            padding: 1rem 1.5rem;
            font-size: 1.2rem;
            color: #0f0f0f;
            background: #00ffff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: background 0.3s, box-shadow 0.3s;
            box-shadow: 0 0 10px #00ffff;
        }
        .control-btn:hover {
            background: #33ffff;
        }
        
        /* PDFã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”¨ãƒœã‚¿ãƒ³ã‚’ç·‘è‰²ã« */
        #pdfUploadBtn {
            background: #00aa00;
            box-shadow: 0 0 10px #00aa00;
            color: #fff;
        }
        #pdfUploadBtn:hover {
            background: #00cc00;
        }
    </style>
</head>
<body>
    <canvas id="waveCanvas"></canvas>
    
    <div id="ui">
        <div id="status-area">
            AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆå¾…æ©Ÿä¸­...
        </div>

        <div id="input-controls">
            <input type="file" id="pdfFileInput" accept="application/pdf" style="display: none;">
            <button id="pdfUploadBtn" class="control-btn">PDFã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</button>
            
            <input type="text" id="messageInput" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦å†…å®¹ã‚’æ¤œç´¢" value="">
            <button id="resetBtn" class="control-btn" style="background: #ff5500; box-shadow: 0 0 10px #ff5500;">ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
        
        <p id="learnedTitleDisplay" style="color: #fff; font-size: 1rem;">å­¦ç¿’æ¸ˆã¿ã‚¿ã‚¤ãƒˆãƒ«: **ãªã—**</p>
    </div>

    <script>
        // --- 1. ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–¢é€£ (å¤‰æ›´ãªã—) ---
        const canvas = document.getElementById("waveCanvas");
        const ctx = canvas.getContext("2d");
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let bars = [];
        const barCount = 40;
        const barWidth = 8;
        const waveY = canvas.height / 2;
        let animationFrameId;
        let isSpeaking = false; 

        function createBars() {
            bars = [];
            const startX = canvas.width / 2 - (barCount * barWidth) / 2;
            for (let i = 0; i < barCount; i++) {
                bars.push({
                    x: startX + i * barWidth,
                    height: 10,
                    color: "#00ffff"
                });
            }
        }

        function drawBars() {
            bars.forEach(bar => {
                ctx.fillStyle = bar.color;
                ctx.fillRect(bar.x, waveY - bar.height / 2, barWidth - 2, bar.height); 
            });
        }

        function animateBars() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            bars.forEach(bar => {
                let targetHeight;
                if (isSpeaking) {
                    targetHeight = Math.random() * 80 + 20; 
                } else {
                    targetHeight = 10 + Math.random() * 10;
                }
                
                bar.height += (targetHeight - bar.height) * 0.15;
            });
            
            drawBars();
            animationFrameId = requestAnimationFrame(animateBars);
        }
        
        // --- 2. æ“¬ä¼¼å­¦ç¿’ã¨çŠ¶æ…‹ç®¡ç† (è¿½åŠ ãƒ»ä¿®æ­£éƒ¨åˆ†) ---
        const qrInput = document.getElementById("messageInput");
        const statusArea = document.getElementById("status-area");
        const resetBtn = document.getElementById("resetBtn");
        const pdfFileInput = document.getElementById("pdfFileInput");
        const pdfUploadBtn = document.getElementById("pdfUploadBtn");
        const learnedTitleDisplay = document.getElementById("learnedTitleDisplay");
        
        const synth = window.speechSynthesis;
        let utterance = null;
        
        // ğŸ’¡ æ“¬ä¼¼å­¦ç¿’ç”¨ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢
        let learnedData = {
            title: null,
            content: null,
            keywords: [] // æ¤œç´¢ç”¨ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ (ä¾‹: "æŠ€è¡“", "æ¦‚è¦", "å ±å‘Šæ›¸")
        };

        // èª­ã¿ä¸Šã’ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æ›´æ–°
        function updateStatus(message, color = '#00ffff') {
            statusArea.textContent = message;
            statusArea.style.color = color;
            statusArea.style.boxShadow = `0 0 20px ${color}80`;
        }

        // å…¥åŠ›ã•ã‚ŒãŸæ–‡ç« å…¨ä½“ã‚’èª­ã¿ä¸Šã’ã‚‹é–¢æ•°
        function speakSentence(text, callback = null) {
            if (text.trim() === '') return;

            if (synth.speaking) {
                synth.cancel();
            }
            
            utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'ja-JP'; 
            utterance.rate = 1.0;

            utterance.onstart = () => {
                isSpeaking = true;
                const display = text.length > 20 ? text.substring(0, 20) + '...' : text;
                updateStatus(`éŸ³å£°å‡ºåŠ›ä¸­: ã€Œ${display}ã€`, '#00ffaa');
            };
            
            utterance.onend = () => {
                isSpeaking = false;
                updateStatus(learnedData.title ? `å­¦ç¿’æ¸ˆã¿: ${learnedData.title}` : 'AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆå¾…æ©Ÿä¸­...');
                if (callback) callback();
            };

            utterance.onerror = (event) => {
                console.error('Speech Synthesis Error:', event);
                isSpeaking = false;
                updateStatus('èª­ã¿ä¸Šã’ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', '#ff0000');
            };

            synth.speak(utterance);
        }

        // ğŸ’¡ PDFã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç† (æ“¬ä¼¼å­¦ç¿’)
        pdfUploadBtn.addEventListener('click', () => {
            pdfFileInput.click(); // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‹ã
        });

        pdfFileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file && file.type === "application/pdf") {
                
                // --- æ“¬ä¼¼çš„ãªå­¦ç¿’å‡¦ç† ---
                const dummyTitle = `2025å¹´åº¦ ç¬¬3å››åŠæœŸ AIæŠ€è¡“é–‹ç™ºå ±å‘Šæ›¸ (ãƒ•ã‚¡ã‚¤ãƒ«å: ${file.name})`;
                const dummyContent = 
                    "ã“ã®å ±å‘Šæ›¸ã¯ã€æœ€æ–°ã®AIæŠ€è¡“ã§ã‚ã‚‹ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®å¿œç”¨ã¨ã€ãã®ç¤¾ä¼šå®Ÿè£…ã¸ã®ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ã«ã¤ã„ã¦è©³ç´°ã«è¿°ã¹ã¦ã„ã¾ã™ã€‚ç‰¹ã«ã€è‡ªç„¶è¨€èªå‡¦ç†ã®åˆ†é‡ã§ã®ç²¾åº¦å‘ä¸ŠãŒè‘—ã—ãã€ä»ŠæœŸã®ä¸»è¦ãªç›®æ¨™ã‚’é”æˆã—ã¾ã—ãŸã€‚æ¥æœŸã¯ã€ç”»åƒèªè­˜ã¨ãƒ­ãƒœãƒ†ã‚£ã‚¯ã‚¹ã¸ã®çµ±åˆã‚’é‡ç‚¹çš„ã«é€²ã‚ã‚‹äºˆå®šã§ã™ã€‚æŠ€è¡“ã®æ¦‚è¦ã‚„ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ã«ã¤ã„ã¦ã€ã„ã¤ã§ã‚‚ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§è³ªå•ã—ã¦ãã ã•ã„ã€‚";
                
                // ãƒ‡ãƒ¼ã‚¿ã‚’å­¦ç¿’æ¸ˆã¿ã¨ã—ã¦è¨­å®š
                learnedData.title = dummyTitle;
                learnedData.content = dummyContent;
                learnedData.keywords = ["AI", "æŠ€è¡“", "ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«", "è¨€èªå‡¦ç†", "ãƒ­ãƒœãƒ†ã‚£ã‚¯ã‚¹", "ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—", "æ¦‚è¦"];
                
                learnedTitleDisplay.textContent = `å­¦ç¿’æ¸ˆã¿ã‚¿ã‚¤ãƒˆãƒ«: **${learnedData.title}**`;

                // å­¦ç¿’å®Œäº†ã®èª­ã¿ä¸Šã’
                const speakMessage = `PDFã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’å­¦ç¿’ã—ã¾ã—ãŸã€‚å­¦ç¿’ã—ãŸã‚¿ã‚¤ãƒˆãƒ«ã¯ã€ã€Œ${learnedData.title}ã€ã§ã™ã€‚`;
                speakSentence(speakMessage);

            } else {
                updateStatus('PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„', '#ffaa00');
            }
        });
        
        // ğŸ’¡ ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›ã«ã‚ˆã‚‹æ¤œç´¢ã¨èª­ã¿ä¸Šã’
        qrInput.addEventListener('input', (event) => {
            const currentText = qrInput.value.trim().toLowerCase();
            
            if (currentText === "") {
                if (synth.speaking) synth.cancel();
                isSpeaking = false;
                updateStatus(learnedData.title ? `å­¦ç¿’æ¸ˆã¿: ${learnedData.title}` : 'AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆå¾…æ©Ÿä¸­...');
                return;
            }

            if (learnedData.title && learnedData.content) {
                // 1. ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå­¦ç¿’æ¸ˆã¿ã®ã‚¿ã‚¤ãƒˆãƒ«ã¨ä¸€è‡´ã™ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                if (learnedData.title.toLowerCase().includes(currentText)) {
                    speakSentence(`å­¦ç¿’æ¸ˆã¿PDFã®å…¨ä½“å†…å®¹ã‚’èª­ã¿ä¸Šã’ã¾ã™ã€‚${learnedData.content}`);
                } 
                // 2. ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå®šç¾©ã•ã‚ŒãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆã«å«ã¾ã‚Œã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                else if (learnedData.keywords.some(k => currentText.includes(k.toLowerCase()))) {
                    speakSentence(`ã€Œ${currentText}ã€ã«é–¢é€£ã™ã‚‹å†…å®¹ã‚’èª­ã¿ä¸Šã’ã¾ã™ã€‚${learnedData.content.substring(0, 100)}... è©³ç´°ã¯å ±å‘Šæ›¸ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚`);
                }
                // 3. ã©ã¡ã‚‰ã«ã‚‚ä¸€è‡´ã—ãªã„å ´åˆ
                else {
                    updateStatus(`ã€Œ${currentText}ã€ã«é–¢ã™ã‚‹æƒ…å ±ã¯å­¦ç¿’å†…å®¹ã«è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚`, '#ffaa00');
                    if (synth.speaking) synth.cancel();
                    isSpeaking = false;
                }
            } else {
                // å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆ
                speakSentence("ã¾ãšã€å·¦å´ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚");
            }
        });
        
        // ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã®æ©Ÿèƒ½
        resetBtn.addEventListener("click", () => {
            qrInput.value = ""; 
            if (synth.speaking) {
                synth.cancel(); 
            }
            isSpeaking = false;
            
            // å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ
            learnedData.title = null;
            learnedData.content = null;
            learnedData.keywords = [];
            
            learnedTitleDisplay.textContent = `å­¦ç¿’æ¸ˆã¿ã‚¿ã‚¤ãƒˆãƒ«: **ãªã—**`;
            updateStatus('ã‚·ã‚¹ãƒ†ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚');
            pdfFileInput.value = ''; // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠçŠ¶æ…‹ã‚‚ãƒªã‚»ãƒƒãƒˆ
            qrInput.focus();
        });

        // --- 3. åˆæœŸåŒ– ---
        createBars();
        animateBars();
        qrInput.focus();
        updateStatus('AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆå¾…æ©Ÿä¸­...');

    </script>
</body>
</html>
